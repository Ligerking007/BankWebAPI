@model BankWebAPI.Models.CustomerAccount.DetailsViewModel
@{ ViewData["Title"] = Model.CustomerAccountModel.AccountNo; }

<div class="card mb-6">
    <div class="card-body hover-parent">
        <h2 class="card-title text-center">
            <span id="accountName">@Model.CustomerAccountModel.FullName</span>
            <i class="fas fa-pen fa-xs cursor-pointer hover-visible text-muted text-primary-hover"
               data-toggle="modal" data-target="#editModal">
            </i>
        </h2>

        <div class="row">
            <div class="col-lg">
            </div>
            <div class="col-lg-6">
                <h5 class="text-center">Account details</h5>
        
                <div class="d-flex flex-row justify-content-between">
                    <p>ID Card / Passport</p>
                    <p class="ml-3"> <span id="idCardOrPassport">@Model.CustomerAccountModel.IdCardPassport</span></p>
                </div>
                <div class="d-flex flex-row justify-content-between">
                    <p>Current balance</p>
                    <p class="text-green ml-3">฿@Model.CustomerAccountModel.Balance.ToString("#,##0.00")</p>
                </div>
                <div class="d-flex flex-row justify-content-between">
                    <p>Account number</p>
                    <p class="ml-3">@Model.CustomerAccountModel.AccountNo</p>
                </div>
                <div class="d-flex flex-row justify-content-between">
                    <p>IBAN number</p>
                    <p class="ml-3">@Model.CustomerAccountModel.IbanNo</p>
                </div>
                <div class="d-flex flex-row justify-content-between">
                    <p>Date of creation</p>
                    <p class="ml-3 auto-format-date">@Model.CustomerAccountModel.CreatedDate.ToString("O")</p>
                </div>

            </div>
            <div class="col-lg">
            </div>
        </div>

        </div>
</div>

<div id="editModal" class="modal fade" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Edit account display name</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <form method="post">
                    <input type="hidden" name="accountId" value="@Model.CustomerAccountModel.Id">
                    <div class="form-group">
                        <label>Name</label>
                        <input required class="form-control" type="text" name="name">
                    </div>
                    <div class="form-group">
                        <label>
                            ID Card / Passport
                        </label>
                        <input required class="form-control" type="text" name="idCardPassport" />
                       
                    </div>
                    <div class="text-center d-flex justify-content-between">
                        <button type="button" class="btn btn-secondary mr-auto" data-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary">OK</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<partial name="_TransactionPartial" model="@Model" />

@section Scripts
{
    <script>
        $('#editModal').on('show.bs.modal',
            function() {
                let _modal = $(this);
                let _name = $('#accountName').text();
                let _idCardPassport = $('#idCardOrPassport').text();
                _modal.find('.modal-body input[name=name]').val(_name);
                _modal.find('.modal-body input[name=idCardPassport]').val(_idCardPassport);
            });

        $('#editModal').on('shown.bs.modal',
            function() {
                $(this).find('.modal-body input[name=name]').trigger('focus');
            });

        $('#editModal form').submit(function(event) {
            event.preventDefault();

            $.ajax({
                url: '@Url.Action("UpdateAccount", "CustomerAccount")',
                type: 'post',
                data: $(event.target).serialize()

            }).always(function() {
                $('#editModal').modal('hide');
            }).done(function(response) {
                if (!response.success) {
                    return;
                }

                let _newName = $('#editModal input[name=name]').val();
                let _newIdCard = $('#editModal input[name=idCardPassport]').val();
                $('#accountName').text(_newName);
                $('#idCardOrPassport').text(_newIdCard);
                
            });
        });
    </script>
}